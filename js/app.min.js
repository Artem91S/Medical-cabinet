(()=>{"use strict";var e={d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{o:()=>E});class t{constructor(e,t,a){this.title="",this.cardiologist=e,this.dentist=t,this.therapeutic=a}createModal(e){let t=`\n    <section class="modal">\n    <div class="modal__content">\n        <div class="modal__content__close-btn">&times;</div>\n              <h3 class="modal__content__title">${e}</h3>  \n              <select name="doctor" class="modal__content__choose__doctor">\n                <option class="doctor"name="doctor">Усі</option>\n                <option class="doctor" name="doctor" value="Кардіолог">${this.cardiologist}</option>\n                <option class="doctor" name="doctor" value="Стоматолог">${this.dentist}</option>\n                <option class="doctor" name="doctor" value="Терапевт">${this.therapeutic}</option>   \n             </select>  \n                <form class="modal-creating__form form flex__forma">            \n                  \n                </form>\n        <button class="btn btn__send__visit">Відправити</button>\n    </div>\n    </section>\n    `;document.body.insertAdjacentHTML("beforeend",t)}closeModal(){document.querySelector(".modal").remove()}clickCloseModal(){let e=document.querySelector(".modal"),t=document.querySelector(".modal__content__close-btn");e.addEventListener("click",(a=>{a.target!==e&&a.target!==t||this.closeModal()}))}createModalEnter(e){let t=`\n        <section class="modal">\n        <div class="modal__content">\n        <h2 class="modal__content__title">${e}</h2>\n        <div class="modal__content__close-btn">&times;</div>\n            <label for='email'>Email:</label>\n            <input type='email' name='email' class="modal__email"/>\n            <label for='password'>Password:</label>\n            <input type='password' name='password' class="modal__password"/>\n            <button class="modal__content__registration-btn btn btn--red">Увійти</button>\n            </div>\n        </section>\n         `;document.body.insertAdjacentHTML("beforeend",t)}}class a{constructor(e,t,a,r,s){this.fullName=e,this.visitType=t,this.visitDescription=a,this.visitUrgency=r,this.visitStatus=s}createForma(e){let t=`\n                <label for="fullName"class="visit__labels">${this.fullName}:</label>\n                     <input name="fullName" type="text" value="" class="border input--size">\n               <label for="visitType" class="visit__labels">${this.visitType}:</label>\n                     <input name="visitType" type="text" value="" class="border input--size">\n                <label for="visitDescription" class="visit__labels">${this.visitDescription}:</label>\n                     <textarea cols="10" class="border"  name="visitDescription" value="" rows="5"></textarea>\n                <label for="impotent" class="visit__labels">${this.visitStatus}:</label>\n                <select name="visitStatus" class="input--size">\n                    <option name="visitStatus" value="Вікрита">Вікрита</option>\n                    <option name="visitStatus"value="Закрита">Закрита</option>\n                </select>\n                <label for="impotent" class="visit__labels">${this.visitUrgency}:</label>\n                <select name="visitUrgency" class="input--size">\n                    <option value="Невідкладна">Невідкладна</option>\n                    <option value="Пріоритетна">Пріоритетна</option>\n                    <option value="Звичайна">Звичайна</option>                \n              </select>`;e.insertAdjacentHTML("beforeend",t)}}class r extends a{constructor(e,t,a,r,s,n,o,c,d){super(e,t,a,r,d),this.bloodPressure=s,this.indexWeight=n,this.cardiovascularDisease=o,this.age=c}createFormСardiologist(e){super.createForma(e);let t=`\n        <div class="add__inputs Сardiologist">\n           <label class="visit__labels">${this.bloodPressure}:</label>\n                <input name="bloodPressure" type="text" class="border input--size">\n           <label class="visit__labels">${this.indexWeight}:</label>\n                <input name="bodyMassIndex" type="text" class="border input--size">\n           <label class="visit__labels">${this.cardiovascularDisease}:</label>\n                <input name="cardiovascularDisease" type="text" class="border input--size">\n           <label for="age"class="visit__labels">${this.age}:</label>\n                <input name="age"type="text" class="border input--size">\n       </div>\n        `;e.insertAdjacentHTML("beforeend",t)}}class s extends a{constructor(e,t,a,r,s,n){super(e,t,a,r,n),this.visitDate=s}createFormDentist(e){super.createForma(e);let t=`\n        <div class="add__inputs Dentist">\n           <label for="visitDate" class="visit__labels">${this.visitDate}:</label>\n           <input type="date" name="visitDate" class="border input--size">\n       </div>\n        `;e.insertAdjacentHTML("beforeend",t)}}class n extends a{constructor(e,t,a,r,s,n){super(e,t,a,r,n),this.visitAge=s}createFormTherapeutic(e){super.createForma(e);let t=`\n        <div class="add__inputs Therapeutic">\n           <label for="age" class="visit__labels">${this.visitAge}:</label>\n           <input type="text" name="age" class="border input--size">\n       </div>\n        `;e.insertAdjacentHTML("beforeend",t)}}const o=document.querySelector(".cards-filters__dropdown-condition"),c=document.querySelector(".cards-filters__dropdown-visits-term"),d=document.querySelector(".cards-filters__input-search"),i=document.querySelector(".cards-filters__btn-search");class l{constructor(e,t,a){this.searchInput=e,this.filterCards=[],this.array=t,this.btn=a}validationFilters(e,t,a){this.btn.addEventListener("click",(()=>{const r=a?this.filterCards:v.length>0?v:[];this.filterCards=r.filter((a=>{if("Усі"===e.value)return document.querySelectorAll(".board-of-cards__patient-card").forEach((e=>{if(e.classList.remove("board-of-cards__patient-card__hidden-filter-card"),e.dataset.id!==a.id)return e.classList.add("board-of-cards__patient-card__hidden-filter-card")})),this.filterCards;let r=a[t]!==e.value?"add":"remove";return document.querySelector(`[data-id="${a.id}"]`)?.classList[r]("board-of-cards__patient-card__hidden-filter-card"),"remove"==r}))}))}clickOnButtonSearch(){this.btn.addEventListener("click",(()=>{this.filterCards.forEach((e=>{if(document.querySelector(`[data-id="${e.id}"]`).classList.remove("board-of-cards__patient-card__hidden-filter-card"),!Object.values(e).some((e=>e.toString().toLowerCase().match(this.searchInput.value.toLowerCase()))))return document.querySelector(`[data-id="${e.id}"]`).classList.add("board-of-cards__patient-card__hidden-filter-card")}))}))}}const _=document.querySelector(".board-of-cards");class p{constructor(e,t,a,r,s,n){this.visitType=t,this.fullName=e,this.visitDescription=a,this.id=n,this.visitUrgency=s,this.status=r}renderingCard(){let e=`\n        <div class="board-of-cards__patient-card" data-doctor=${this.doctor} data-id=${this.id}>\n            <h2  class="board-of-cards__patient-card__title" >Картка візиту</h2>\n            <div  class="board-of-cards__patient-card__options" >\n              <p class="board-of-cards__patient-card__close-btn">&times;</p>\n              <p class="board-of-cards__patient-card__edit-btn" >&#10000;</p>\n            </div>\n            <div class="board-of-cards__patient-card__content">\n              <p class="board-of-cards__patient-card__property-name">Доктор:</p>\n              <p class="board-of-cards__patient-card__property-name"data-name="doctor">${this.doctor}</p>\n              <p class="board-of-cards__patient-card__property-name">ПІБ:</p>\n              <p class="board-of-cards__patient-card__property-name" data-name="fullName">${this.fullName}</p>\n            <button class="board-of-cards__patient-card__btn-details" data-btn="${this.id}">Детальніше</button>\n            <div class="board-of-cards__patient-card__more-details" data-detailsid="${this.id}">\n              <p class="board-of-cards__patient-card__property-name">Статус:</p>\n              <p class="board-of-cards__patient-card__property-name" data-name="visitStatus">${this.status}</p>\n              <p class="board-of-cards__patient-card__property-name">Терміновість візиту:</p>\n              <p class="board-of-cards__patient-card__property-name" data-name="visitUrgency">${this.visitUrgency}</p>\n              <p class="board-of-cards__patient-card__property-name">Тип візиту:</p>\n              <p class="board-of-cards__patient-card__property-name" data-name="visitType">${this.visitType}</p>\n              <p class="board-of-cards__patient-card__property-name">Опис:</p>\n              <p class="board-of-cards__patient-card__property-name" data-name="visitDescription">${this.visitDescription}</p>\n            </div>\n          </div>\n        </div>\n        `;_.insertAdjacentHTML("beforeend",e),q.classList.add("hidden")}hiddenDetails(e){document.body.addEventListener("click",(e=>{e.target===document.querySelector(".board-of-cards")&&document.querySelectorAll(".board-of-cards__patient-card__more-details").forEach((e=>{e.classList.remove("click-on-details")}))})),e.addEventListener("click",(e=>{e.target.parentElement.dataset.id===e.target.dataset.id&&e.target.closest("div").querySelector(".board-of-cards__patient-card__more-details").classList.toggle("click-on-details")}))}}class u extends p{constructor(e,t,a,r,s,n,o,c,d,i,l){super(t,a,r,s,n,l),this.doctor=e,this.bloodPressure=o,this.bodyMassIndex=c,this.cardiovascularDisease=d,this.age=i}renderingCard(){super.renderingCard();let e=document.querySelector(`[data-btn="${this.id}"]`),t=`\n      <p class="board-of-cards__patient-card__property-name">Вік:</p>\n      <p class="board-of-cards__patient-card__property-name" data-name="age">${this.age}</p>\n      <p class="board-of-cards__patient-card__property-name">Тиск:</p>\n      <p class="board-of-cards__patient-card__property-name" data-name="bloodPressure">${this.bloodPressure}</p>\n      <p class="board-of-cards__patient-card__property-name">Індекс тіла:</p>\n      <p class="board-of-cards__patient-card__property-name" data-name="bodyMassIndex">${this.bodyMassIndex}</p>\n      <p class="board-of-cards__patient-card__property-name">Серцеві захворювання:</p>\n      <p class="board-of-cards__patient-card__property-name" data-name="cardiovascularDisease">${this.cardiovascularDisease}</p>\n \n  `;e.closest("div").querySelector(".board-of-cards__patient-card__more-details").insertAdjacentHTML("beforeend",t),super.hiddenDetails(e)}}class m extends p{constructor(e,t,a,r,s,n,o,c){super(t,a,r,s,n,c),this.doctor=e,this.visitDate=o}renderingCard(){super.renderingCard();let e=document.querySelector(`[data-btn="${this.id}"]`),t=`\n        <p class="board-of-cards__patient-card__property-name">Дата візиту:</p>\n        <p class="board-of-cards__patient-card__property-name" data-name="visitDate">${this.visitDate}</p>\n    `;e.closest("div").querySelector(".board-of-cards__patient-card__more-details").insertAdjacentHTML("beforeend",t),super.hiddenDetails(e)}}class h extends p{constructor(e,t,a,r,s,n,o,c){super(t,a,r,s,n,c),this.doctor=e,this.ageTherapist=o}renderingCard(){super.renderingCard();let e=document.querySelector(`[data-btn="${this.id}"]`),t=`\n          <p class="board-of-cards__patient-card__property-name">Вік:</p>\n          <p class="board-of-cards__patient-card__property-name"data-name="age">${this.ageTherapist}</p>\n      `;e.closest("div").querySelector(".board-of-cards__patient-card__more-details").insertAdjacentHTML("beforeend",t),super.hiddenDetails(e)}}let b=new t("Кардіолог","Стоматолог","Терапевт");function f(e,t,a,o){function c(t,a,r){return e[t]=a.bind(r)}t=new r("ПІБ","Мета візиту","Короткий опис візиту","Tерміновість","Звичайний тиск","Індекс маси тіла","Перенесені захворювання серцево-судинної системи","Вік","Статус візиту"),a=new s("ПІБ","Мета візиту","Короткий опис візиту","Tерміновість","Дата останнього відвідування","Статус візиту"),o=new n("ПІБ","Мета візиту","Короткий опис візиту","Tерміновість","Вік","Статус візиту"),c("Кардіолог",t.createFormСardiologist,t),c("Стоматолог",a.createFormDentist,a),c("Терапевт",o.createFormTherapeutic,o)}document.querySelector(".header__btn-create-card").addEventListener("click",(e=>{e.preventDefault(),b.createModal("Створити візит"),b.clickCloseModal();const t=document.querySelector(".modal-creating__form"),a=document.querySelector(".modal__content__choose__doctor"),r={};f(r,void 0,void 0,void 0),a.addEventListener("change",(()=>{t.innerHTML="",r[a.value](t),function(e,t){const a=document.querySelector(".modal");document.querySelector(".btn__send__visit").addEventListener("click",(()=>{const r={};a.querySelectorAll("select,input,textarea").forEach((e=>{const{name:t}=e;r[t]=e.value,0===e.value.length?"error-create-card"!==e.nextElementSibling?.className&&e.insertAdjacentHTML("afterend",'<p class="error-create-card">поле не може бути пустим</p>'):"error-create-card"==e.nextElementSibling?.className&&e.nextElementSibling.remove()})),Object.values(r).every((e=>e.length>0))&&fetch("https://ajax.test-danit.com/api/v2/cards",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(r)}).then((e=>e.json())).then((e=>{v=[e,...v],t.closeModal(),y([e])}))}))}(A,b)}))}));let v=[];function y(e){let t=new l(d,e,i);document.querySelector(".cards-filters").addEventListener("change",(()=>{t.validationFilters(o,"visitStatus",!1),t.validationFilters(c,"visitUrgency",!0),t.clickOnButtonSearch()})),new p,e.forEach((e=>{const t=Object.values(e),[a]=t;let r;"Кардіолог"===a?r=new u(...t):"Стоматолог"===a?r=new m(...t):"Терапевт"===a&&(r=new h(...t)),r.renderingCard()}))}function g(e,t,a){Array.from(document.querySelector(`[data-id="${a}"]`).querySelector(`.${t}`).children).filter((e=>{if(e.hasAttribute("data-name"))return e})).forEach((t=>{e[t.dataset.name]=t.textContent}))}document.querySelector(".board-of-cards").addEventListener("click",(e=>{let a=e.target.closest("div").parentElement.dataset.id;"board-of-cards__patient-card__edit-btn"===e.target.className&&e.target.closest("div").parentElement.dataset.id===a&&async function(e){const a={},r={};g(r,"board-of-cards__patient-card__content",e),g(a,"board-of-cards__patient-card__more-details",e);const s={...r,...a},{doctor:n}=s;let o=new t("Кардіоло","Стоматолог","Терапевт");const c={};f(c,undefined,undefined,undefined),o.createModal("Змінити візит");const d=document.querySelector(".modal-creating__form"),i=document.querySelector(".modal__content__choose__doctor");document.querySelectorAll(".doctor").forEach((e=>{e.value===n&&(e.selected="selected")})),c[s.doctor](d),document.querySelectorAll("input,textarea,select").forEach((e=>{Object.keys(s).includes(e.name)&&(e.value=s[e.name])})),i.addEventListener("change",(()=>{d.innerHTML="",c[i.value](d),document.querySelectorAll("input,textarea,select").forEach((e=>{s.doctor=i.value,Object.keys(s).includes(e.name)&&(e.value=s[e.name])}))})),function(e,t,a){const r=document.querySelector(`[data-id="${a}"]`),s=document.querySelector(".modal");document.querySelector(".btn__send__visit").addEventListener("click",(()=>{const n={};s.querySelectorAll("select,input,textarea").forEach((e=>{const{name:t}=e;n[t]=e.value,0===e.value.length?"error-create-card"!==e.nextElementSibling?.className&&e.insertAdjacentHTML("afterend",'<p class="error-create-card">поле не може бути пустим</p>'):"error-create-card"==e.nextElementSibling?.className&&e.nextElementSibling.remove()})),v=v.filter((e=>{if(e.id!=a)return e})),Object.values(n).every((e=>e.length>0))&&fetch(`https://ajax.test-danit.com/api/v2/cards/${a}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(n)}).then((e=>{if(e.ok)return e.json()})).then((t=>{v=[t,...v],r.remove(),y([t]),e.closeModal()}))}))}(o,A,e),o.clickCloseModal()}(a)})),function(e){let t=document.querySelector(".wrapp-loader");e.addEventListener("click",(e=>{let a=e.target.closest("div").parentElement;if("board-of-cards__patient-card__close-btn"===e.target.className){let e=a.dataset.id;if(confirm("Ви дійсно хочити видалити картку?")){t.classList.remove("hidden");try{fetch(`https://ajax.test-danit.com/api/v2/cards/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${A}`}}).then((r=>{200===r.status&&(setTimeout((()=>{t.classList.add("hidden")}),2e3),a.remove(),!_.contains(document.querySelector(".board-of-cards__patient-card"))&&q.classList.remove("hidden")),v=v.filter((t=>{if(t.id!=e)return t}))}))}catch(e){console.error(e)}}}}))}(_);const S=document.querySelector(".header__btn-login"),q=document.querySelector(".board-of-cards__text");let L=new t;S.onclick=function(){L.createModalEnter("Прошу введіть дані:");const e=document.querySelector(".modal"),t=document.querySelector(".modal__content__close-btn");L.clickCloseModal(e,t),document.querySelector(".modal__content__registration-btn").addEventListener("click",(()=>{let e=document.querySelector(".modal__email").value,t=document.querySelector(".modal__password").value;e.length>0&&e.includes("@")&&t.length>0?(async function(e,t){let a=await fetch("https://ajax.test-danit.com/api/v2/cards/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:`${e}`,password:`${t}`})});200!==a.status?!document.querySelector(".incorrect-login")&&document.querySelector(".modal__content__registration-btn").insertAdjacentHTML("afterend",'<h2 class="incorrect-login">Невірний логін чи пароль</h2>'):(A=await a.text(),L.closeModal(),function(e){const t={token:`${e}`};localStorage.setItem("token",JSON.stringify(t))}(A),$(JSON.parse(localStorage.getItem("token"))?.token))}(e,t),q.classList.add("hidden")):function(e,t){!e.includes("@")||!e.length>0?(!t.length>0&&!document.querySelector(".error-password")?document.querySelector(".modal__password").insertAdjacentHTML("afterend",'<p class="error-password">Невірний password</p>'):t.length>0&&document.querySelector(".error-password")&&document.querySelector(".error-password").remove(),!document.querySelector(".error-email")&&document.querySelector(".modal__email").insertAdjacentHTML("afterend",'<p class="error-email">Невірний email</p>')):!t.length>0?(!e.includes("@")||!e.length>0?document.querySelector(".modal__email").insertAdjacentHTML("afterend",'<p class="error-email">Невірний email</p>'):document.querySelector(".error-email")&&document.querySelector(".error-email").remove(),!document.querySelector(".error-password")&&document.querySelector(".modal__password").insertAdjacentHTML("afterend",'<p class="error-password">Невірний password</p>')):(!document.querySelector(".error-password")||!document.querySelector(".error-email"))&&(document.querySelector(".modal__password").insertAdjacentHTML("afterend",'<p class="error-password">Невірний password</p>'),document.querySelector(".modal__email").insertAdjacentHTML("afterend",'<p class="error-email">Невірний email</p>'))}(e,t)}))};let A="";function $(e){e&&(E("header__btn"),E("cards-filters"),async function(e){let t=await fetch("https://ajax.test-danit.com/api/v2/cards",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}),a=await t.json();0!==a.length?(v=a,q.classList.add("hidden"),y(a)):q.classList.remove("hidden")}(e))}var w,T;A=JSON.parse(localStorage.getItem("token"))?.token,window.onload=()=>{$(A)},document.querySelector(".header__btn-exit").addEventListener("click",(()=>{q.classList.remove("hidden"),E("header__btn"),E("cards-filters"),localStorage.removeItem("token"),document.querySelectorAll(".board-of-cards__patient-card").forEach((e=>e.remove()))})),w=function(e){let t=!0===e?"webp":"no-webp";document.documentElement.classList.add(t)},(T=new Image).onload=T.onerror=function(){w(2==T.height)},T.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";const E=e=>{document.querySelectorAll(`.${e}`).forEach((e=>e.classList.toggle("hidden")))}})();